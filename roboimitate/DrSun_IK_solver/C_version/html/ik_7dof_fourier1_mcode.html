<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T1U3">theta</span> = ik_7dof_fourier(<span class="var type1" id="S3T2U6">R_x</span>,<span class="var type1" id="S4T2U7">R_y</span>,<span class="var type1" id="S5T2U8">R_z</span>,<span class="var type1" id="S6T2U9">p_x</span>,<span class="var type1" id="S7T2U10">p_y</span>,<span class="var type1" id="S8T2U11">p_z</span>,<span class="var type1" id="S9T2U12">bet</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">% theta = ik_7dof_fourier(R_x,R_y,R_z,p_x,p_y,p_z,bet)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% [q1,q2,q3,q4,q5,q6,q7] = ik_7dof_fourier(R_x,R_y,R_z,p_x,p_y,p_z,bet)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="mxinfo " id="T2:U9"><span class="var type1" id="S10T2U15">d3</span> = <span class="mxinfo " id="T2:U11">246.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="mxinfo " id="T2:U12"><span class="var type1" id="S11T2U19">d5</span> = <span class="mxinfo " id="T2:U14">241.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="mxinfo " id="T2:U15"><span class="var type1" id="S12T2U23">a</span> = <span class="mxinfo " id="T2:U17">40</span></span>;  <span class="comment">% 机械臂尺寸参数</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="mxinfo " id="T3:U18"><span class="var type1" id="S13T3U27">R07</span> = <span class="mxinfo " id="T3:U20">[<span class="mxinfo " id="T4:U21"><span class="mxinfo " id="T2:U22"><span class="mxinfo " id="T2:U23">cos(<span class="var type1" id="S3T2U33">R_x</span>)</span>*<span class="mxinfo " id="T2:U25">cos(<span class="var type1" id="S4T2U36">R_y</span>)</span></span>, <span class="mxinfo " id="T2:U27"><span class="mxinfo " id="T2:U28"><span class="mxinfo " id="T2:U29"><span class="mxinfo " id="T2:U30">cos(<span class="var type1" id="S3T2U42">R_x</span>)</span>*<span class="mxinfo " id="T2:U32">sin(<span class="var type1" id="S4T2U45">R_y</span>)</span></span>*<span class="mxinfo " id="T2:U34">sin(<span class="var type1" id="S5T2U48">R_z</span>)</span></span>-<span class="mxinfo " id="T2:U36"><span class="mxinfo " id="T2:U37">sin(<span class="var type1" id="S3T2U52">R_x</span>)</span>*<span class="mxinfo " id="T2:U39">cos(<span class="var type1" id="S5T2U55">R_z</span>)</span></span></span>, <span class="mxinfo " id="T2:U41"><span class="mxinfo " id="T2:U42"><span class="mxinfo " id="T2:U43"><span class="mxinfo " id="T2:U44">cos(<span class="var type1" id="S3T2U61">R_x</span>)</span>*<span class="mxinfo " id="T2:U46">sin(<span class="var type1" id="S4T2U64">R_y</span>)</span></span>*<span class="mxinfo " id="T2:U48">cos(<span class="var type1" id="S5T2U67">R_z</span>)</span></span>+<span class="mxinfo " id="T2:U50"><span class="mxinfo " id="T2:U51">sin(<span class="var type1" id="S3T2U71">R_x</span>)</span>*<span class="mxinfo " id="T2:U53">sin(<span class="var type1" id="S5T2U74">R_z</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line">       <span class="mxinfo " id="T4:U55"><span class="mxinfo " id="T2:U56"><span class="mxinfo " id="T2:U57">sin(<span class="var type1" id="S3T2U79">R_x</span>)</span>*<span class="mxinfo " id="T2:U59">cos(<span class="var type1" id="S4T2U82">R_y</span>)</span></span>, <span class="mxinfo " id="T2:U61"><span class="mxinfo " id="T2:U62"><span class="mxinfo " id="T2:U63"><span class="mxinfo " id="T2:U64">sin(<span class="var type1" id="S3T2U88">R_x</span>)</span>*<span class="mxinfo " id="T2:U66">sin(<span class="var type1" id="S4T2U91">R_y</span>)</span></span>*<span class="mxinfo " id="T2:U68">sin(<span class="var type1" id="S5T2U94">R_z</span>)</span></span>+<span class="mxinfo " id="T2:U70"><span class="mxinfo " id="T2:U71">cos(<span class="var type1" id="S3T2U98">R_x</span>)</span>*<span class="mxinfo " id="T2:U73">cos(<span class="var type1" id="S5T2U101">R_z</span>)</span></span></span>, <span class="mxinfo " id="T2:U75"><span class="mxinfo " id="T2:U76"><span class="mxinfo " id="T2:U77"><span class="mxinfo " id="T2:U78">sin(<span class="var type1" id="S3T2U107">R_x</span>)</span>*<span class="mxinfo " id="T2:U80">sin(<span class="var type1" id="S4T2U110">R_y</span>)</span></span>*<span class="mxinfo " id="T2:U82">cos(<span class="var type1" id="S5T2U113">R_z</span>)</span></span>-<span class="mxinfo " id="T2:U84"><span class="mxinfo " id="T2:U85">cos(<span class="var type1" id="S3T2U117">R_x</span>)</span>*<span class="mxinfo " id="T2:U87">sin(<span class="var type1" id="S5T2U120">R_z</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line">       <span class="mxinfo " id="T4:U89"><span class="mxinfo " id="T2:U90">-<span class="mxinfo " id="T2:U91">sin(<span class="var type1" id="S4T2U125">R_y</span>)</span></span>, <span class="mxinfo " id="T2:U93"><span class="mxinfo " id="T2:U94">cos(<span class="var type1" id="S4T2U129">R_y</span>)</span>*<span class="mxinfo " id="T2:U96">sin(<span class="var type1" id="S5T2U132">R_z</span>)</span></span>, <span class="mxinfo " id="T2:U98"><span class="mxinfo " id="T2:U99">cos(<span class="var type1" id="S4T2U136">R_y</span>)</span>*<span class="mxinfo " id="T2:U101">cos(<span class="var type1" id="S5T2U139">R_z</span>)</span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">% R07 = [1,0,0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%        0,1,0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%        0,0,1];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="mxinfo " id="T5:U103"><span class="var type1" id="S16T5U142">p</span> = <span class="mxinfo " id="T5:U105">[ <span class="var type1" id="S6T2U145">p_x</span> ; <span class="var type1" id="S7T2U147">p_y</span> ; <span class="var type1" id="S8T2U149">p_z</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="mxinfo " id="T5:U109"><span class="var type1" id="S17T5U152">x</span> = <span class="mxinfo " id="T5:U111">[1;0;0]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="mxinfo " id="T5:U112"><span class="var type1" id="S18T5U162">n</span> = <span class="mxinfo " id="T5:U114">cross(<span class="var type1" id="S16T5U165">p</span>,<span class="mxinfo " id="T5:U116">-<span class="var type1" id="S17T5U167">x</span></span>)</span></span>;  <span class="comment">% 零位面法向量为n</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="mxinfo " id="T5:U118"><span class="var type1" id="S18T5U170">n</span> = <span class="mxinfo " id="T5:U120"><span class="var type1" id="S18T5U172">n</span>/<span class="mxinfo " id="T2:U122">norm(<span class="var type1" id="S18T5U175">n</span>,2)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="mxinfo " id="T5:U124"><span class="var type1" id="S21T5U179">p_e</span> = <span class="mxinfo " id="T5:U126"><span class="var type1" id="S16T5U181">p</span>/<span class="mxinfo " id="T2:U128">norm(<span class="var type1" id="S16T5U184">p</span>,2)</span></span></span>;  <span class="comment">% 归一化的p</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="mxinfo " id="T3:U130"><span class="var type1" id="S22T3U188">Rbet</span> = <span class="mxinfo " id="T3:U132">[<span class="mxinfo " id="T4:U133"><span class="mxinfo " id="T2:U134"><span class="mxinfo " id="T2:U135"><span class="mxinfo " id="T2:U136"><span class="mxinfo " id="T2:U137"><span class="var type1" id="S21T5U195">p_e</span>(<span class="mxinfo " id="T6:U139">1</span>)</span>^2</span>*(<span class="mxinfo " id="T2:U140"><span class="mxinfo " id="T2:U141">1</span>-<span class="mxinfo " id="T2:U142">cos(<span class="var type1" id="S9T2U203">bet</span>)</span></span>)</span>+<span class="mxinfo " id="T2:U144">cos(<span class="var type1" id="S9T2U206">bet</span>)</span></span>, <span class="mxinfo " id="T2:U146"><span class="mxinfo " id="T2:U147"><span class="mxinfo " id="T2:U148"><span class="mxinfo " id="T2:U149"><span class="var type1" id="S21T5U211">p_e</span>(<span class="mxinfo " id="T6:U151">1</span>)</span>*<span class="mxinfo " id="T2:U152"><span class="var type1" id="S21T5U214">p_e</span>(<span class="mxinfo " id="T2:U154">2</span>)</span></span>*(<span class="mxinfo " id="T2:U155"><span class="mxinfo " id="T2:U156">1</span>-<span class="mxinfo " id="T2:U157">cos(<span class="var type1" id="S9T2U221">bet</span>)</span></span>)</span>-<span class="mxinfo " id="T2:U159"><span class="mxinfo " id="T2:U160"><span class="var type1" id="S21T5U224">p_e</span>(<span class="mxinfo " id="T2:U162">3</span>)</span>*<span class="mxinfo " id="T2:U163">sin(<span class="var type1" id="S9T2U228">bet</span>)</span></span></span>, <span class="mxinfo " id="T2:U165"><span class="mxinfo " id="T2:U166"><span class="mxinfo " id="T2:U167"><span class="mxinfo " id="T2:U168"><span class="var type1" id="S21T5U233">p_e</span>(<span class="mxinfo " id="T6:U170">1</span>)</span>*<span class="mxinfo " id="T2:U171"><span class="var type1" id="S21T5U236">p_e</span>(<span class="mxinfo " id="T2:U173">3</span>)</span></span>*(<span class="mxinfo " id="T2:U174"><span class="mxinfo " id="T2:U175">1</span>-<span class="mxinfo " id="T2:U176">cos(<span class="var type1" id="S9T2U243">bet</span>)</span></span>)</span>+<span class="mxinfo " id="T2:U178"><span class="mxinfo " id="T2:U179"><span class="var type1" id="S21T5U246">p_e</span>(<span class="mxinfo " id="T2:U181">2</span>)</span>*<span class="mxinfo " id="T2:U182">sin(<span class="var type1" id="S9T2U250">bet</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line">        <span class="mxinfo " id="T4:U184"><span class="mxinfo " id="T2:U185"><span class="mxinfo " id="T2:U186"><span class="mxinfo " id="T2:U187"><span class="mxinfo " id="T2:U188"><span class="var type1" id="S21T5U256">p_e</span>(<span class="mxinfo " id="T6:U190">1</span>)</span>*<span class="mxinfo " id="T2:U191"><span class="var type1" id="S21T5U259">p_e</span>(<span class="mxinfo " id="T2:U193">2</span>)</span></span>*(<span class="mxinfo " id="T2:U194"><span class="mxinfo " id="T2:U195">1</span>-<span class="mxinfo " id="T2:U196">cos(<span class="var type1" id="S9T2U266">bet</span>)</span></span>)</span>+<span class="mxinfo " id="T2:U198"><span class="mxinfo " id="T2:U199"><span class="var type1" id="S21T5U269">p_e</span>(<span class="mxinfo " id="T2:U201">3</span>)</span>*<span class="mxinfo " id="T2:U202">sin(<span class="var type1" id="S9T2U273">bet</span>)</span></span></span>, <span class="mxinfo " id="T2:U204"><span class="mxinfo " id="T2:U205"><span class="mxinfo " id="T2:U206"><span class="mxinfo " id="T2:U207"><span class="var type1" id="S21T5U278">p_e</span>(<span class="mxinfo " id="T6:U209">2</span>)</span>^2</span>*(<span class="mxinfo " id="T2:U210"><span class="mxinfo " id="T2:U211">1</span>-<span class="mxinfo " id="T2:U212">cos(<span class="var type1" id="S9T2U286">bet</span>)</span></span>)</span>+<span class="mxinfo " id="T2:U214">cos(<span class="var type1" id="S9T2U289">bet</span>)</span></span>, <span class="mxinfo " id="T2:U216"><span class="mxinfo " id="T2:U217"><span class="mxinfo " id="T2:U218"><span class="mxinfo " id="T2:U219"><span class="var type1" id="S21T5U294">p_e</span>(<span class="mxinfo " id="T6:U221">2</span>)</span>*<span class="mxinfo " id="T2:U222"><span class="var type1" id="S21T5U297">p_e</span>(<span class="mxinfo " id="T2:U224">3</span>)</span></span>*(<span class="mxinfo " id="T2:U225"><span class="mxinfo " id="T2:U226">1</span>-<span class="mxinfo " id="T2:U227">cos(<span class="var type1" id="S9T2U304">bet</span>)</span></span>)</span>-<span class="mxinfo " id="T2:U229"><span class="mxinfo " id="T2:U230"><span class="var type1" id="S21T5U307">p_e</span>(<span class="mxinfo " id="T2:U232">1</span>)</span>*<span class="mxinfo " id="T2:U233">sin(<span class="var type1" id="S9T2U311">bet</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line">        <span class="mxinfo " id="T4:U235"><span class="mxinfo " id="T2:U236"><span class="mxinfo " id="T2:U237"><span class="mxinfo " id="T2:U238"><span class="mxinfo " id="T2:U239"><span class="var type1" id="S21T5U317">p_e</span>(<span class="mxinfo " id="T6:U241">1</span>)</span>*<span class="mxinfo " id="T2:U242"><span class="var type1" id="S21T5U320">p_e</span>(<span class="mxinfo " id="T2:U244">3</span>)</span></span>*(<span class="mxinfo " id="T2:U245"><span class="mxinfo " id="T2:U246">1</span>-<span class="mxinfo " id="T2:U247">cos(<span class="var type1" id="S9T2U327">bet</span>)</span></span>)</span>-<span class="mxinfo " id="T2:U249"><span class="mxinfo " id="T2:U250"><span class="var type1" id="S21T5U330">p_e</span>(<span class="mxinfo " id="T2:U252">2</span>)</span>*<span class="mxinfo " id="T2:U253">sin(<span class="var type1" id="S9T2U334">bet</span>)</span></span></span>, <span class="mxinfo " id="T2:U255"><span class="mxinfo " id="T2:U256"><span class="mxinfo " id="T2:U257"><span class="mxinfo " id="T2:U258"><span class="var type1" id="S21T5U339">p_e</span>(<span class="mxinfo " id="T6:U260">2</span>)</span>*<span class="mxinfo " id="T2:U261"><span class="var type1" id="S21T5U342">p_e</span>(<span class="mxinfo " id="T2:U263">3</span>)</span></span>*(<span class="mxinfo " id="T2:U264"><span class="mxinfo " id="T2:U265">1</span>-<span class="mxinfo " id="T2:U266">cos(<span class="var type1" id="S9T2U349">bet</span>)</span></span>)</span>+<span class="mxinfo " id="T2:U268"><span class="mxinfo " id="T2:U269"><span class="var type1" id="S21T5U352">p_e</span>(<span class="mxinfo " id="T2:U271">1</span>)</span>*<span class="mxinfo " id="T2:U272">sin(<span class="var type1" id="S9T2U356">bet</span>)</span></span></span>, <span class="mxinfo " id="T2:U274"><span class="mxinfo " id="T2:U275"><span class="mxinfo " id="T2:U276"><span class="mxinfo " id="T2:U277"><span class="var type1" id="S21T5U361">p_e</span>(<span class="mxinfo " id="T6:U279">3</span>)</span>^2</span>*(<span class="mxinfo " id="T2:U280"><span class="mxinfo " id="T2:U281">1</span>-<span class="mxinfo " id="T2:U282">cos(<span class="var type1" id="S9T2U369">bet</span>)</span></span>)</span>+<span class="mxinfo " id="T2:U284">cos(<span class="var type1" id="S9T2U372">bet</span>)</span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="mxinfo " id="T5:U286"><span class="var type1" id="S23T5U375">n4</span> = <span class="mxinfo " id="T5:U288"><span class="var type1" id="S22T3U377">Rbet</span>*<span class="var type1" id="S18T5U378">n</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo " id="T5:U291"><span class="var type1" id="S24T5U381">Rk0x</span> = <span class="mxinfo " id="T5:U293">[<span class="mxinfo " id="T2:U294"><span class="var type1" id="S21T5U385">p_e</span>(<span class="mxinfo " id="T6:U296">1</span>)</span>;<span class="mxinfo " id="T2:U297"><span class="var type1" id="S21T5U389">p_e</span>(<span class="mxinfo " id="T6:U299">2</span>)</span>;<span class="mxinfo " id="T2:U300"><span class="var type1" id="S21T5U393">p_e</span>(<span class="mxinfo " id="T6:U302">3</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo " id="T5:U303"><span class="var type1" id="S25T5U397">Rk0z</span> = <span class="mxinfo " id="T5:U305">[<span class="mxinfo " id="T2:U306"><span class="var type1" id="S23T5U401">n4</span>(<span class="mxinfo " id="T6:U308">1</span>)</span>;<span class="mxinfo " id="T2:U309"><span class="var type1" id="S23T5U405">n4</span>(<span class="mxinfo " id="T6:U311">2</span>)</span>;<span class="mxinfo " id="T2:U312"><span class="var type1" id="S23T5U409">n4</span>(<span class="mxinfo " id="T6:U314">3</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="mxinfo " id="T5:U315"><span class="var type1" id="S26T5U413">Rk0y</span> = <span class="mxinfo " id="T5:U317">cross(<span class="var type1" id="S25T5U416">Rk0z</span>,<span class="var type1" id="S24T5U417">Rk0x</span>)</span></span>;     <span class="comment">%得到k轴方向的y在0中的描述</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="mxinfo " id="T5:U320"><span class="var type1" id="S26T5U420">Rk0y</span> = <span class="mxinfo " id="T5:U322"><span class="var type1" id="S26T5U422">Rk0y</span>/<span class="mxinfo " id="T2:U324">norm(<span class="var type1" id="S26T5U425">Rk0y</span>,2)</span></span></span>;    <span class="comment">%归一化，真正得到k轴的y在0中的描述</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="mxinfo " id="T3:U326"><span class="var type1" id="S27T3U429">Rk0</span> = <span class="mxinfo " id="T3:U328">[<span class="var type1" id="S24T5U432">Rk0x</span>,<span class="var type1" id="S26T5U433">Rk0y</span>,<span class="var type1" id="S25T5U434">Rk0z</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo " id="T2:U332"><span class="var type1" id="S28T2U437">BE_L</span> =  <span class="mxinfo " id="T2:U334">sqrt(<span class="var type1" id="S12T2U442">a</span>^2+<span class="var type1" id="S10T2U445">d3</span>^2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo " id="T2:U337"><span class="var type1" id="S30T2U449">cB</span> = <span class="mxinfo " id="T2:U339">( <span class="mxinfo " id="T2:U340"><span class="mxinfo " id="T2:U341"><span class="mxinfo " id="T2:U342"><span class="var type1" id="S28T2U455">BE_L</span>^2</span> +<span class="mxinfo " id="T2:U344"><span class="mxinfo " id="T2:U345">norm(<span class="var type1" id="S16T5U460">p</span>,2)</span>^2</span></span> - <span class="mxinfo " id="T2:U347"><span class="var type1" id="S11T2U464">d5</span>^2</span></span> ) / (<span class="mxinfo " id="T2:U349"><span class="mxinfo " id="T2:U350"><span class="mxinfo " id="T2:U351">2</span>*<span class="var type1" id="S28T2U470">BE_L</span></span>*<span class="mxinfo " id="T2:U353">norm(<span class="var type1" id="S16T5U473">p</span>,2)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="mxinfo " id="T2:U355"><span class="var type1" id="S31T2U477">sB</span> = <span class="mxinfo " id="T2:U357">sqrt(<span class="mxinfo " id="T2:U358"><span class="mxinfo " id="T2:U359">1</span>-<span class="mxinfo " id="T2:U360"><span class="var type1" id="S30T2U483">cB</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo " id="T3:U362"><span class="var type1" id="S32T3U487">Rkkp</span> = <span class="mxinfo " id="T3:U364">[<span class="mxinfo " id="T4:U365"><span class="var type1" id="S30T2U490">cB</span>,<span class="mxinfo " id="T2:U367">-<span class="var type1" id="S31T2U492">sB</span></span>,<span class="mxinfo " id="T2:U369">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line">        <span class="mxinfo " id="T4:U370"><span class="var type1" id="S31T2U495">sB</span>,<span class="var type1" id="S30T2U496">cB</span>,<span class="mxinfo " id="T2:U373">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line">        <span class="mxinfo " id="T4:U374">0,0,1</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"><span class="mxinfo " id="T5:U375"><span class="var type1" id="S33T5U504">pEkp</span> = <span class="mxinfo " id="T5:U377">[sqrt(<span class="var type1" id="S10T2U511">d3</span>^2+<span class="var type1" id="S12T2U514">a</span>^2);0;0]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo " id="T5:U380"><span class="var type1" id="S34T5U522">pE0</span> = <span class="mxinfo " id="T5:U382"><span class="mxinfo " id="T3:U383"><span class="var type1" id="S27T3U525">Rk0</span>*<span class="var type1" id="S32T3U526">Rkkp</span></span>*<span class="var type1" id="S33T5U527">pEkp</span></span></span>;          <span class="comment">% E点坐标在0系下的表示, xE=pE0(1), yE=pE0(2), zE=pE0(3)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"><span class="mxinfo " id="T2:U387"><span class="var type1" id="S35T2U530">ph_fai</span> = <span class="mxinfo " id="T2:U389">acos(<span class="mxinfo " id="T2:U390"><span class="var type1" id="S10T2U534">d3</span>/sqrt(<span class="var type1" id="S10T2U539">d3</span>^2+<span class="var type1" id="S12T2U542">a</span>^2)</span>)</span></span>; <span class="comment">% 角fai</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="mxinfo " id="T2:U394"><span class="var type1" id="S37T2U546">theta2</span> = <span class="mxinfo " id="T2:U396"><span class="mxinfo " id="T2:U397">acos(<span class="mxinfo " id="T2:U398"><span class="mxinfo " id="T2:U399"><span class="var type1" id="S34T5U552">pE0</span>(<span class="mxinfo " id="T6:U401">3</span>)</span>/<span class="mxinfo " id="T2:U402">sqrt(<span class="var type1" id="S10T2U558">d3</span>^2+<span class="var type1" id="S12T2U561">a</span>^2)</span></span>)</span> - <span class="var type1" id="S35T2U563">ph_fai</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">% 以上求得theta2 </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"><span class="mxinfo " id="T2:U406"><span class="var type1" id="S38T2U566">cond_BE</span> = <span class="mxinfo " id="T2:U408"><span class="mxinfo " id="T2:U409"><span class="var type1" id="S12T2U569">a</span>*<span class="mxinfo " id="T2:U411">cos(<span class="var type1" id="S37T2U572">theta2</span>)</span></span>+<span class="mxinfo " id="T2:U413"><span class="var type1" id="S10T2U574">d3</span>*<span class="mxinfo " id="T2:U415">sin(<span class="var type1" id="S37T2U577">theta2</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T7:U417"><span class="mxinfo " id="T2:U418">abs(<span class="var type1" id="S38T2U583">cond_BE</span>)</span> &gt; <span class="mxinfo " id="T2:U420">1e-6</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line">     <span class="mxinfo " id="T2:U421"><span class="var type1" id="S40T2U587">theta1</span> = <span class="mxinfo " id="T2:U423">atan2(<span class="mxinfo " id="T2:U424"><span class="mxinfo " id="T2:U425"><span class="var type1" id="S34T5U592">pE0</span>(<span class="mxinfo " id="T6:U427">2</span>)</span>/<span class="var type1" id="S38T2U594">cond_BE</span></span>,<span class="mxinfo " id="T2:U429"><span class="mxinfo " id="T2:U430"><span class="var type1" id="S34T5U597">pE0</span>(<span class="mxinfo " id="T6:U432">1</span>)</span>/<span class="var type1" id="S38T2U599">cond_BE</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line">     <span class="mxinfo " id="T2:U434"><span class="var type1" id="S40T2U603">theta1</span> = <span class="mxinfo " id="T2:U436">-<span class="var type1" id="S35T2U605">ph_fai</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">% theta1 = pi - theta1; %不知道发生了什么，这里反一下就好了</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">% 以上求得theta1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="mxinfo " id="T8:U438"><span class="var type1" id="S42T8U608">T01</span> =<span class="mxinfo " id="T8:U440">[ <span class="mxinfo " id="T9:U441"><span class="mxinfo " id="T2:U442">cos(<span class="var type1" id="S40T2U613">theta1</span>)</span>, <span class="mxinfo " id="T2:U444">-<span class="mxinfo " id="T2:U445">sin(<span class="var type1" id="S40T2U617">theta1</span>)</span></span>, <span class="mxinfo " id="T2:U447">0</span>, <span class="mxinfo " id="T2:U448">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line">       <span class="mxinfo " id="T9:U449"><span class="mxinfo " id="T2:U450">sin(<span class="var type1" id="S40T2U623">theta1</span>)</span>,  <span class="mxinfo " id="T2:U452">cos(<span class="var type1" id="S40T2U626">theta1</span>)</span>, <span class="mxinfo " id="T2:U454">0</span>, <span class="mxinfo " id="T2:U455">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line">                 <span class="mxinfo " id="T9:U456">0,            0, 1, 0</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line">                 <span class="mxinfo " id="T9:U457">0,            0, 0, 1</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="mxinfo " id="T8:U458"><span class="var type1" id="S43T8U641">T12</span> =<span class="mxinfo " id="T8:U460">[  <span class="mxinfo " id="T9:U461"><span class="mxinfo " id="T2:U462">cos(<span class="var type1" id="S37T2U646">theta2</span>)</span>, <span class="mxinfo " id="T2:U464">-<span class="mxinfo " id="T2:U465">sin(<span class="var type1" id="S37T2U650">theta2</span>)</span></span>, <span class="mxinfo " id="T2:U467">0</span>, <span class="mxinfo " id="T2:U468">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line">                  <span class="mxinfo " id="T9:U469">0,            0, 1, 0</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line">       <span class="mxinfo " id="T9:U470"><span class="mxinfo " id="T2:U471">-<span class="mxinfo " id="T2:U472">sin(<span class="var type1" id="S37T2U662">theta2</span>)</span></span>, <span class="mxinfo " id="T2:U474">-<span class="mxinfo " id="T2:U475">cos(<span class="var type1" id="S37T2U666">theta2</span>)</span></span>, <span class="mxinfo " id="T2:U477">0</span>, <span class="mxinfo " id="T2:U478">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line">                  <span class="mxinfo " id="T9:U479">0,            0, 0, 1</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"><span class="mxinfo " id="T8:U480"><span class="var type1" id="S44T8U676">T02</span> = <span class="mxinfo " id="T8:U482"><span class="var type1" id="S42T8U678">T01</span>*<span class="var type1" id="S43T8U679">T12</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"><span class="mxinfo " id="T10:U485"><span class="var type1" id="S45T10U682">pC0</span> = <span class="mxinfo " id="T10:U487"><span class="var type1" id="S44T8U684">T02</span>*<span class="mxinfo " id="T10:U489">[<span class="var type1" id="S12T2U687">a</span>;0;0;1]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="mxinfo " id="T5:U491"><span class="var type1" id="S46T5U696">pCW</span> = <span class="mxinfo " id="T5:U493"><span class="var type1" id="S16T5U698">p</span> - <span class="mxinfo " id="T5:U495"><span class="var type1" id="S45T10U700">pC0</span>(<span class="mxinfo " id="T4:U497"><span class="mxinfo " id="T2:U498">1</span>:<span class="mxinfo " id="T2:U499">3</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"><span class="mxinfo " id="T2:U500"><span class="var type1" id="S47T2U706">cond_th4</span> = <span class="mxinfo " id="T2:U502"><span class="mxinfo " id="T2:U503"><span class="mxinfo " id="T2:U504"><span class="var type1" id="S10T2U710">d3</span>^2</span>+<span class="mxinfo " id="T2:U506"><span class="var type1" id="S11T2U713">d5</span>^2</span></span>-<span class="mxinfo " id="T2:U508"><span class="mxinfo " id="T2:U509">norm(<span class="var type1" id="S46T5U718">pCW</span>,2)</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T7:U511"><span class="var type1" id="S47T2U724">cond_th4</span> &gt; <span class="mxinfo " id="T2:U513">1e-6</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line">     <span class="mxinfo " id="T2:U514"><span class="var type1" id="S48T2U728">theta4</span> = <span class="mxinfo " id="T2:U516"><span class="mxinfo " id="T2:U517">pi</span> - <span class="mxinfo " id="T2:U518">acos( <span class="mxinfo " id="T2:U519"><span class="var type1" id="S47T2U735">cond_th4</span> /(<span class="mxinfo " id="T2:U521">2*<span class="var type1" id="S10T2U740">d3</span>*<span class="var type1" id="S11T2U741">d5</span></span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line">     <span class="mxinfo " id="T2:U524"><span class="var type1" id="S48T2U745">theta4</span> = <span class="mxinfo " id="T2:U526">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">% 以上求得theta4</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="mxinfo " id="T5:U527"><span class="var type1" id="S50T5U749">EW</span> = <span class="mxinfo " id="T5:U529"><span class="var type1" id="S16T5U751">p</span> - <span class="var type1" id="S34T5U752">pE0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"><span class="mxinfo " id="T5:U532"><span class="var type1" id="S51T5U755">z4</span> = <span class="mxinfo " id="T5:U534">cross(<span class="var type1" id="S46T5U758">pCW</span>,<span class="var type1" id="S50T5U759">EW</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"><span class="mxinfo " id="T5:U537"><span class="var type1" id="S51T5U762">z4</span> = <span class="mxinfo " id="T5:U539"><span class="var type1" id="S51T5U764">z4</span>/<span class="mxinfo " id="T2:U541">norm(<span class="var type1" id="S51T5U767">z4</span>,2)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T7:U543"><span class="mxinfo " id="T2:U544">sin(<span class="var type1" id="S37T2U774">theta2</span>)</span>==<span class="mxinfo " id="T2:U546">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line">     <span class="mxinfo " id="T2:U547"><span class="var type1" id="S52T2U778">theta3</span> = <span class="mxinfo " id="T2:U549"><span class="mxinfo " id="T2:U550">atan2(<span class="mxinfo " id="T2:U551">-<span class="mxinfo " id="T2:U552"><span class="var type1" id="S51T5U784">z4</span>(<span class="mxinfo " id="T6:U554">1</span>)</span></span>,<span class="mxinfo " id="T2:U555"><span class="var type1" id="S51T5U787">z4</span>(<span class="mxinfo " id="T6:U557">2</span>)</span>)</span> - <span class="var type1" id="S40T2U789">theta1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"><span class="keyword">elseif</span> <span class="mxinfo " id="T7:U559"><span class="mxinfo " id="T2:U560">abs(<span class="mxinfo " id="T2:U561">sin(<span class="var type1" id="S37T2U797">theta2</span>)</span>)</span> &gt; <span class="mxinfo " id="T2:U563">1e-6</span></span> &amp;&amp; <span class="mxinfo " id="T7:U564"><span class="mxinfo " id="T2:U565">abs(<span class="mxinfo " id="T2:U566">cos(<span class="var type1" id="S40T2U804">theta1</span>)</span>)</span> &lt; <span class="mxinfo " id="T2:U568">1e-6</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line">     <span class="mxinfo " id="T2:U569"><span class="var type1" id="S52T2U808">theta3</span> = <span class="mxinfo " id="T2:U571">atan2(<span class="mxinfo " id="T2:U572"><span class="mxinfo " id="T2:U573"><span class="var type1" id="S51T5U813">z4</span>(<span class="mxinfo " id="T6:U575">3</span>)</span>/<span class="mxinfo " id="T2:U576">sin(<span class="var type1" id="S37T2U817">theta2</span>)</span></span>, <span class="mxinfo " id="T2:U578"><span class="mxinfo " id="T2:U579">-(<span class="mxinfo " id="T2:U580"><span class="mxinfo " id="T2:U581"><span class="var type1" id="S51T5U823">z4</span>(<span class="mxinfo " id="T6:U583">1</span>)</span> + <span class="mxinfo " id="T2:U584"><span class="mxinfo " id="T2:U585"><span class="mxinfo " id="T2:U586"><span class="mxinfo " id="T2:U587">cos(<span class="var type1" id="S40T2U830">theta1</span>)</span>*<span class="mxinfo " id="T2:U589">cos(<span class="var type1" id="S37T2U833">theta2</span>)</span></span>*<span class="mxinfo " id="T2:U591"><span class="var type1" id="S51T5U835">z4</span>(<span class="mxinfo " id="T2:U593">3</span>)</span></span>/<span class="mxinfo " id="T2:U594">sin(<span class="var type1" id="S37T2U839">theta2</span>)</span></span></span>)</span>/<span class="mxinfo " id="T2:U596">sin(<span class="var type1" id="S40T2U842">theta1</span>)</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">     <span class="mxinfo " id="T2:U598"><span class="var type1" id="S52T2U846">theta3</span> = <span class="mxinfo " id="T2:U600">atan2(<span class="mxinfo " id="T2:U601"><span class="mxinfo " id="T2:U602"><span class="var type1" id="S51T5U851">z4</span>(<span class="mxinfo " id="T6:U604">3</span>)</span>/<span class="mxinfo " id="T2:U605">sin(<span class="var type1" id="S37T2U855">theta2</span>)</span></span>, <span class="mxinfo " id="T2:U607">(<span class="mxinfo " id="T2:U608"><span class="mxinfo " id="T2:U609"><span class="var type1" id="S51T5U860">z4</span>(<span class="mxinfo " id="T6:U611">2</span>)</span> + <span class="mxinfo " id="T2:U612"><span class="mxinfo " id="T2:U613"><span class="mxinfo " id="T2:U614"><span class="mxinfo " id="T2:U615">sin(<span class="var type1" id="S40T2U867">theta1</span>)</span>*<span class="mxinfo " id="T2:U617">cos(<span class="var type1" id="S37T2U870">theta2</span>)</span></span>*<span class="mxinfo " id="T2:U619"><span class="var type1" id="S51T5U872">z4</span>(<span class="mxinfo " id="T2:U621">3</span>)</span></span>/<span class="mxinfo " id="T2:U622">sin(<span class="var type1" id="S37T2U876">theta2</span>)</span></span></span>)/<span class="mxinfo " id="T2:U624">cos(<span class="var type1" id="S40T2U879">theta1</span>)</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">% 以上求得theta3</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="mxinfo " id="T8:U626"><span class="var type1" id="S53T8U882">T23</span> =<span class="mxinfo " id="T8:U628">[ <span class="mxinfo " id="T9:U629"><span class="mxinfo " id="T2:U630">cos(<span class="var type1" id="S52T2U887">theta3</span>)</span>, <span class="mxinfo " id="T2:U632">-<span class="mxinfo " id="T2:U633">sin(<span class="var type1" id="S52T2U891">theta3</span>)</span></span>,  <span class="mxinfo " id="T2:U635">0</span>,   <span class="var type1" id="S12T2U893">a</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">                 <span class="mxinfo " id="T9:U637">0,            0, -1, -<span class="var type1" id="S10T2U900">d3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">       <span class="mxinfo " id="T9:U639"><span class="mxinfo " id="T2:U640">sin(<span class="var type1" id="S52T2U904">theta3</span>)</span>,  <span class="mxinfo " id="T2:U642">cos(<span class="var type1" id="S52T2U907">theta3</span>)</span>,  <span class="mxinfo " id="T2:U644">0</span>,   <span class="mxinfo " id="T2:U645">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line">                 <span class="mxinfo " id="T9:U646">0,            0,  0,   1</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line"><span class="mxinfo " id="T8:U647"><span class="var type1" id="S54T8U917">T34</span> =<span class="mxinfo " id="T8:U649">[  <span class="mxinfo " id="T9:U650"><span class="mxinfo " id="T2:U651">cos(<span class="var type1" id="S48T2U922">theta4</span>)</span>, <span class="mxinfo " id="T2:U653">-<span class="mxinfo " id="T2:U654">sin(<span class="var type1" id="S48T2U926">theta4</span>)</span></span>, <span class="mxinfo " id="T2:U656">0</span>, <span class="mxinfo " id="T2:U657">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line">                  <span class="mxinfo " id="T9:U658">0,            0, 1, 0</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">       <span class="mxinfo " id="T9:U659"><span class="mxinfo " id="T2:U660">-<span class="mxinfo " id="T2:U661">sin(<span class="var type1" id="S48T2U938">theta4</span>)</span></span>, <span class="mxinfo " id="T2:U663">-<span class="mxinfo " id="T2:U664">cos(<span class="var type1" id="S48T2U942">theta4</span>)</span></span>, <span class="mxinfo " id="T2:U666">0</span>, <span class="mxinfo " id="T2:U667">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">                  <span class="mxinfo " id="T9:U668">0,            0, 0, 1</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line"><span class="mxinfo " id="T8:U669"><span class="var type1" id="S55T8U952">T04</span> = <span class="mxinfo " id="T8:U671"><span class="mxinfo " id="T8:U672"><span class="var type1" id="S44T8U955">T02</span>*<span class="var type1" id="S53T8U956">T23</span></span>*<span class="var type1" id="S54T8U957">T34</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"><span class="mxinfo " id="T3:U676"><span class="var type1" id="S56T3U960">R04</span> = <span class="mxinfo " id="T3:U678"><span class="var type1" id="S55T8U962">T04</span>(<span class="mxinfo " id="T11:U680">1:3</span>,<span class="mxinfo " id="T11:U681">1:3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"><span class="mxinfo " id="T3:U682"><span class="var type1" id="S57T3U971">R47</span> = <span class="mxinfo " id="T3:U684"><span class="mxinfo " id="T3:U685"><span class="var type1" id="S56T3U974">R04</span>'</span>*<span class="var type1" id="S13T3U975">R07</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"><span class="mxinfo " id="T2:U688"><span class="var type1" id="S58T2U978">theta6</span> = <span class="mxinfo " id="T2:U690">acos( <span class="mxinfo " id="T2:U691">-<span class="mxinfo " id="T2:U692"><span class="var type1" id="S57T3U983">R47</span>(<span class="mxinfo " id="T6:U694">2</span>,<span class="mxinfo " id="T6:U695">3</span>)</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line"><span class="comment">% 以上求得theta6</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T7:U696"><span class="mxinfo " id="T2:U697">abs(<span class="var type1" id="S58T2U991">theta6</span>)</span> &gt; <span class="mxinfo " id="T2:U699">1e-6</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">     <span class="mxinfo " id="T2:U700"><span class="var type1" id="S59T2U995">theta5</span> = <span class="mxinfo " id="T2:U702">atan2( <span class="mxinfo " id="T2:U703"><span class="mxinfo " id="T2:U704"><span class="var type1" id="S57T3U1000">R47</span>(<span class="mxinfo " id="T6:U706">3</span>,<span class="mxinfo " id="T6:U707">3</span>)</span>/<span class="mxinfo " id="T2:U708">sin(<span class="var type1" id="S58T2U1005">theta6</span>)</span></span>, <span class="mxinfo " id="T2:U710"><span class="mxinfo " id="T2:U711"><span class="var type1" id="S57T3U1008">R47</span>(<span class="mxinfo " id="T6:U713">1</span>,<span class="mxinfo " id="T6:U714">3</span>)</span>/<span class="mxinfo " id="T2:U715">sin(<span class="var type1" id="S58T2U1013">theta6</span>)</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">     <span class="mxinfo " id="T2:U717"><span class="var type1" id="S60T2U1016">theta7</span> = <span class="mxinfo " id="T2:U719">atan2( <span class="mxinfo " id="T2:U720"><span class="mxinfo " id="T2:U721">-<span class="mxinfo " id="T2:U722"><span class="var type1" id="S57T3U1022">R47</span>(<span class="mxinfo " id="T6:U724">2</span>,<span class="mxinfo " id="T6:U725">2</span>)</span></span>/<span class="mxinfo " id="T2:U726">sin(<span class="var type1" id="S58T2U1027">theta6</span>)</span></span>, <span class="mxinfo " id="T2:U728"><span class="mxinfo " id="T2:U729"><span class="var type1" id="S57T3U1030">R47</span>(<span class="mxinfo " id="T6:U731">2</span>,<span class="mxinfo " id="T6:U732">1</span>)</span>/<span class="mxinfo " id="T2:U733">sin(<span class="var type1" id="S58T2U1035">theta6</span>)</span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">     <span class="mxinfo " id="T2:U735"><span class="var type1" id="S59T2U1039">theta5</span> = <span class="mxinfo " id="T2:U737">0</span></span>;  <span class="comment">% 真实机器人赋予上一时刻值</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line">     <span class="mxinfo " id="T2:U738"><span class="var type1" id="S60T2U1043">theta7</span> = <span class="mxinfo " id="T2:U740"><span class="mxinfo " id="T2:U741">atan2( <span class="mxinfo " id="T2:U742">-<span class="mxinfo " id="T2:U743"><span class="var type1" id="S57T3U1049">R47</span>(<span class="mxinfo " id="T6:U745">1</span>,<span class="mxinfo " id="T6:U746">2</span>)</span></span>, <span class="mxinfo " id="T2:U747"><span class="var type1" id="S57T3U1053">R47</span>(<span class="mxinfo " id="T6:U749">3</span>,<span class="mxinfo " id="T6:U750">2</span>)</span> )</span> - <span class="var type1" id="S59T2U1056">theta5</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"><span class="mxinfo " id="T1:U752"><span class="var type1" id="S2T1U1059">theta</span> = <span class="mxinfo " id="T1:U754">[<span class="var type1" id="S40T2U1062">theta1</span>,<span class="var type1" id="S37T2U1063">theta2</span>,<span class="var type1" id="S52T2U1064">theta3</span>,<span class="var type1" id="S48T2U1065">theta4</span>,<span class="var type1" id="S59T2U1066">theta5</span>,<span class="var type1" id="S58T2U1067">theta6</span>,<span class="var type1" id="S60T2U1068">theta7</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"><span class="comment">% [q1,q2,q3,q4,q5,q6,q7] = [theta1,theta2,theta3,theta4,theta5,theta6,theta7];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"><span class="comment">% q1 = theta1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"><span class="comment">% q2 = theta2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"><span class="comment">% q3 = theta3;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line"><span class="comment">% q4 = theta4;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line"><span class="comment">% q5 = theta5;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line"><span class="comment">% q6 = theta6;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line"><span class="comment">% q7 = theta7;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line"><span class="comment">% theta = theta*(180/pi);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% 整个函数是end</span></span></span>
</pre>
